---
title: '七牛云文件上传'
date: '2021/3/10 14:59:21'
categories:
   - python
tags:
   - 七牛云文件上传
toc_level: 3
version: 3
---
![cover](images/tree.png)

## 七牛云存储

### 准备工作：
1、到七牛官网：https://www.qiniu.com/。创建账号。然后到个人面板->秘钥管理处获取access_key和secret_key。 

2、创建空间，可以选择华北区等。 

#### 一、安装包
    pip install qiniu

#### 二、后端
1、 创建一个获取token的url

```js

--------上传AccessKey和SecretKey---------
from qiniu import Auth
from .settings import AccessKey,SecretKey


def qiniu_token():
    # 定义密钥
    qn = Auth(AccessKey, SecretKey)
    # 指定上传空间, 返回token值
    token = qn.upload_token('sbzjj')
    return token
    
```
```js
from django.views import View
from django.http import JsonResponse


class UpTokenView(View):

    def get(self, request):
        return JsonResponse({'token': qiniu_token()})
```
二、前段
```js   
    <template>
  <div>
      <p style="text-align: center;"><input type="file" @change="upload_qiniu"></p>
          <p v-if="img_url" style="text-align: center;"><img :src="img_url" alt="" style="width: 200px; height: 200px; border-radius:50%;"></p>
  </div>
</template>

<script>
export default {
  data () {
    return {
          img_url: '',
          // 七牛去上传凭证
          uptoken: '',
    };
  },
  methods: {
         // 获取uptoken
    get_uptoken() {
        this.$axios.get('uptoken/').then(res=>{
            this.uptoken = res.data.token
        })
    },
    // 七牛云上传
    upload_qiniu(e) {
        // 获取文件对象
        let file = e.target.files[0]
        // 声明参数
        let form_data = new FormData()
        // 将上传凭证添加参数
        form_data.append('token', this.uptoken)
        // 添加图片
        form_data.append('file', file)
        // 定制化axios  不携带cookie上传
        const axios_qiniu = this.$axios.create({withCredentials:false})
        // 发送请求
        axios_qiniu({
            method: 'post',
            url: 'http://up-z1.qiniu.com/',
            data: form_data,
            tiemout: 30000,

        }).then(res=>{
            console.log(res)
            this.img_url = 'http://qq5jf6dzd.hb-bkt.clouddn.com/' + res.data.key
        })
    }
  },
  mounted(){
    this.get_uptoken()
  },
}

</script>
<style>
     
</style>
```